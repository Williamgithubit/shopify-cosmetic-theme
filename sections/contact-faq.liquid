{% liquid
  assign heading = section.settings.heading
  assign subheading = section.settings.subheading
%}

<div class="contact-faq section-spacing">
  <div class="page-width">
    <div class="contact-faq__header text-center" data-scroll-reveal>
      {%- if heading != blank -%}
        <h2 class="contact-faq__heading h2">{{ heading | escape }}</h2>
      {%- endif -%}
      {%- if subheading != blank -%}
        <p class="contact-faq__subheading">{{ subheading | escape }}</p>
      {%- endif -%}
    </div>

    {%- if section.blocks.size > 0 -%}
      <div
        class="contact-faq__accordion"
        data-scroll-reveal
        data-scroll-reveal-delay="200">
        {%- for block in section.blocks -%}
          <div class="faq-item" {{ block.shopify_attributes }}>
            <button
              type="button"
              class="faq-question"
              aria-expanded="false"
              aria-controls="faq-answer-{{ forloop.index }}"
              id="faq-question-{{ forloop.index }}">
              <span class="faq-question-text">{{ block.settings.question | escape }}</span>
              <svg
                class="faq-icon"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                aria-hidden="true">
                <polyline points="6 9 12 15 18 9" />
              </svg>
            </button>
            <div
              class="faq-answer"
              id="faq-answer-{{ forloop.index }}"
              role="region"
              aria-labelledby="faq-question-{{ forloop.index }}"
              hidden>
              <div class="faq-answer-content">
                {{ block.settings.answer }}
              </div>
            </div>
          </div>
        {%- endfor -%}
      </div>
    {%- else -%}
      <div class="contact-faq__empty">
        <p>Add FAQ blocks to answer common questions</p>
      </div>
    {%- endif -%}
  </div>
</div>

<style>
  .contact-faq {
    background: #fafafa;
  }

  .contact-faq__header {
    margin-bottom: var(--spacing-3xl, 64px);
  }

  .contact-faq__heading {
    margin-bottom: var(--spacing-md, 16px);
    font-size: clamp(2.8rem, 4vw, 4.2rem);
    color: var(--color-text, #2c2c2c);
  }

  .contact-faq__subheading {
    font-size: 1.8rem;
    color: #666;
    max-width: 700px;
    margin: 0 auto;
    line-height: 1.6;
  }

  .contact-faq__accordion {
    max-width: 900px;
    margin: 0 auto;
  }

  .faq-item {
    background: white;
    border-radius: var(--radius-lg, 12px);
    margin-bottom: var(--spacing-md, 16px);
    overflow: hidden;
    box-shadow: var(--shadow-sm, 0 1px 3px 0 rgba(0, 0, 0, 0.1));
    transition: all var(--transition-base, 0.25s);
  }

  .faq-item:hover {
    box-shadow: var(--shadow-md, 0 4px 6px -1px rgba(0, 0, 0, 0.1));
  }

  .faq-question {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-lg, 24px);
    padding: var(--spacing-xl, 32px) var(--spacing-lg, 24px);
    background: transparent;
    border: none;
    text-align: left;
    cursor: pointer;
    font-size: 1.8rem;
    font-weight: 600;
    color: var(--color-text, #2c2c2c);
    transition: all var(--transition-fast, 0.15s);
  }

  .faq-question:hover {
    color: var(--color-primary, #d4a574);
  }

  .faq-question:focus {
    outline: 2px solid var(--color-primary, #d4a574);
    outline-offset: -2px;
  }

  .faq-question-text {
    flex: 1;
  }

  .faq-icon {
    flex-shrink: 0;
    color: var(--color-primary, #d4a574);
    transition: transform var(--transition-base, 0.25s);
  }

  .faq-question[aria-expanded="true"] .faq-icon {
    transform: rotate(180deg);
  }

  .faq-answer {
    overflow: hidden;
    transition: all var(--transition-base, 0.25s);
  }

  .faq-answer[hidden] {
    display: block;
    max-height: 0;
    opacity: 0;
  }

  .faq-answer:not([hidden]) {
    max-height: 1000px;
    opacity: 1;
  }

  .faq-answer-content {
    padding: 0 var(--spacing-lg, 24px) var(--spacing-xl,;
    font-size: 1.6rem;
    line-height: 1.8;
    color: #666;
  }

  .faq-answer-content p {
    margin-bottom: var(--spacing-md, 16px);
  }

  .faq-answer-content p:last-child {
    margin-bottom: 0;
  }

  .faq-answer-content a {
    color: var(--color-primary, #d4a574);
    text-decoration: underline;
    transition: color var(--transition-fast, 0.15s);
  }

  .faq-answer-content a:hover,
  .faq-answer-content a:focus {
    color: var(--color-secondary, #c89563);
  }

  .contact-faq__empty {
    text-align: center;
    padding: var(--spacing-4xl, 96px) var(--spacing-xl, 32px);
    color: #999;
    font-size: 1.6rem;
  }

  @media screen and (max-width: 749px) {
    .faq-question {
      padding: var(--spacing-lg, 24px) var(--spacing-md, 16px);
      font-size: 1.6rem;
    }

    .faq-answer-content {
      padding: 0 var(--spacing-md, 16px) var(--spacing-lg,;
      font-size: 1.5rem;
    }
  }
</style>

<script>
  class FAQAccordion {
    constructor() {
      this.accordions = document.querySelectorAll('.contact-faq__accordion');
      if (this.accordions.length === 0) return;
      this.init();
    }
  
    init() {
      this.accordions.forEach(accordion => {
        const questions = accordion.querySelectorAll('.faq-question');
        questions.forEach(question => {
          question.addEventListener('click', () => this.toggle(question));
        });
      });
    }
  
    toggle(question) {
      const isExpanded = question.getAttribute('aria-expanded') === 'true';
      const answer = document.getElementById(question.getAttribute('aria-controls'));
      
      if (isExpanded) {
        this.close(question, answer);
      } else {
        this.open(question, answer);
      }
    }
  
    open(question, answer) {
      question.setAttribute('aria-expanded', 'true');
      answer.removeAttribute('hidden');
      
      // Smooth scroll into view if needed
      setTimeout(() => {
        const rect = question.getBoundingClientRect();
        const isInView = rect.top >= 0 && rect.bottom <= window.innerHeight;
        if (!isInView) {
          question.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
      }, 100);
    }
  
    close(question, answer) {
      question.setAttribute('aria-expanded', 'false');
      answer.setAttribute('hidden', '');
    }
  }
  
  // Initialize on DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      new FAQAccordion();
    });
  } else {
    new FAQAccordion();
  }
  
  // Reinitialize on Shopify section load
  if (typeof Shopify !== 'undefined' && Shopify.designMode) {
    document.addEventListener('shopify:section:load', () => {
      new FAQAccordion();
    });
  }
</script>

{% schema %}
  {
    "name": "Contact FAQ",
    "tag": "section",
    "class": "section-contact-faq",
    "settings": [
      {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "Frequently Asked Questions"
      }, {
        "type": "textarea",
        "id": "subheading",
        "label": "Subheading",
        "default": "Find quick answers to common questions"
      }
    ],
    "blocks": [
      {
        "type": "faq",
        "name": "FAQ Item",
        "settings": [
          {
            "type": "text",
            "id": "question",
            "label": "Question",
            "default": "What are your shipping times?"
          }, {
            "type": "richtext",
            "id": "answer",
            "label": "Answer",
            "default": "<p>We ship orders within 1-2 business days. Delivery typically takes 3-5 business days for domestic orders.</p>"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Contact FAQ",
        "blocks": [
          {
            "type": "faq",
            "settings": {
              "question": "What are your shipping times?",
              "answer": "<p>We ship orders within 1-2 business days. Delivery typically takes 3-5 business days for domestic orders and 7-14 days for international orders.</p>"
            }
          },
          {
            "type": "faq",
            "settings": {
              "question": "What is your return policy?",
              "answer": "<p>We offer a 30-day return policy for unopened products. If you're not satisfied, contact us within 30 days of delivery for a full refund.</p>"
            }
          },
          {
            "type": "faq",
            "settings": {
              "question": "How do I find my perfect shade?",
              "answer": "<p>Use our Shade Finder Quiz on the homepage, or contact our beauty experts who can provide personalized recommendations based on your skin tone and undertone.</p>"
            }
          },
          {
            "type": "faq",
            "settings": {
              "question": "Are your products cruelty-free?",
              "answer": "<p>Yes! All our products are 100% cruelty-free and vegan. We never test on animals and use only ethically sourced ingredients.</p>"
            }
          }, {
            "type": "faq",
            "settings": {
              "question": "Do you offer wholesale pricing?",
              "answer": "<p>Yes, we offer wholesale pricing for salons, spas, and retailers. Please contact us at wholesale@auracosmetics.com for more information.</p>"
            }
          }
        ]
      }
    ]
  }
{% endschema %}