{% liquid
  assign product = product
  assign current_variant = product.selected_or_first_available_variant
  assign featured_media = current_variant.featured_media | default: product.featured_media
%}

<div class="product-main section-spacing">
  <div class="page-width">
    <div class="product-main__grid">
      <div class="product-main__media-wrapper">
        <div class="product-main__media" id="product-media-{{ section.id }}">
          {%- if product.media.size > 0 -%}
            <div class="product-main__media-list">
              {%- for media in product.media -%}
                <div class="product-main__media-item{% if media.id == featured_media.id %} is-active{% endif %}" data-media-id="{{ media.id }}">
                  {%- case media.media_type -%}
                    {%- when 'image' -%}
                      <img
                        srcset="
                          {%- if media.width >= 165 -%}{{ media | image_url: width: 165 }} 165w,{%- endif -%}
                          {%- if media.width >= 360 -%}{{ media | image_url: width: 360 }} 360w,{%- endif -%}
                          {%- if media.width >= 535 -%}{{ media | image_url: width: 535 }} 535w,{%- endif -%}
                          {%- if media.width >= 750 -%}{{ media | image_url: width: 750 }} 750w,{%- endif -%}
                          {%- if media.width >= 1070 -%}{{ media | image_url: width: 1070 }} 1070w,{%- endif -%}
                          {%- if media.width >= 1500 -%}{{ media | image_url: width: 1500 }} 1500w,{%- endif -%}
                          {{ media | image_url }} {{ media.width }}w
                        "
                        sizes="(min-width: 990px) 50vw, 100vw"
                        src="{{ media | image_url: width: 750 }}"
                        alt="{{ media.alt | escape }}"
                        loading="lazy"
                        width="{{ media.width }}"
                        height="{{ media.height }}"
                      >
                    {%- when 'video' -%}
                      {{ media | video_tag: controls: true, muted: true }}
                    {%- when 'external_video' -%}
                      {{ media | external_video_tag }}
                    {%- when 'model' -%}
                      {{ media | model_viewer_tag }}
                  {%- endcase -%}
                </div>
              {%- endfor -%}
            </div>

            {%- if product.media.size > 1 -%}
              <div class="product-main__thumbnails">
                {%- for media in product.media -%}
                  <button
                    class="product-main__thumbnail{% if media.id == featured_media.id %} is-active{% endif %}"
                    data-media-id="{{ media.id }}"
                    aria-label="{{ 'products.product.media_thumbnail' | t: index: forloop.index }}"
                  >
                    <img
                      src="{{ media | image_url: width: 100 }}"
                      alt="{{ media.alt | escape }}"
                      width="100"
                      height="100"
                      loading="lazy"
                    >
                  </button>
                {%- endfor -%}
              </div>
            {%- endif -%}
          {%- else -%}
            <div class="product-main__media-item">
              {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg__image' }}
            </div>
          {%- endif -%}
        </div>
      </div>

      <div class="product-main__info-wrapper{% if section.settings.enable_sticky_info %} product-main__info-wrapper--sticky{% endif %}">
        <div class="product-main__info" data-variant-id="{{ current_variant.id }}">
          {%- for block in section.blocks -%}
            {%- case block.type -%}
              {%- when 'title' -%}
                <h1 class="product-main__title h2" {{ block.shopify_attributes }}>
                  {{ product.title | escape }}
                </h1>

              {%- when 'price' -%}
                <div class="product-main__price" {{ block.shopify_attributes }}>
                  {% render 'price', product: product, use_variant: true %}
                </div>

              {%- when 'variant_picker' -%}
                {%- unless product.has_only_default_variant -%}
                  <div class="product-main__variants" {{ block.shopify_attributes }}>
                    {% render 'product-variant-picker', product: product, block: block %}
                  </div>
                {%- endunless -%}

              {%- when 'quantity_selector' -%}
                <div class="product-main__quantity" {{ block.shopify_attributes }}>
                  <label for="Quantity-{{ section.id }}" class="product-main__quantity-label">
                    {{ 'products.product.quantity_label' | t }}
                  </label>
                  <div class="quantity-selector">
                    <button class="quantity-selector__button" type="button" name="minus" aria-label="{{ 'products.product.quantity_decrease' | t }}">
                      {% render 'icon-minus' %}
                    </button>
                    <input
                      class="quantity-selector__input"
                      type="number"
                      name="quantity"
                      id="Quantity-{{ section.id }}"
                      min="1"
                      value="1"
                      aria-label="{{ 'products.product.quantity_label' | t }}"
                    >
                    <button class="quantity-selector__button" type="button" name="plus" aria-label="{{ 'products.product.quantity_increase' | t }}">
                      {% render 'icon-plus' %}
                    </button>
                  </div>
                </div>

              {%- when 'buy_buttons' -%}
                <div class="product-main__buttons" {{ block.shopify_attributes }}>
                  <button
                    type="submit"
                    name="add"
                    class="product-main__submit button button--primary button--full-width"
                    {% if product.selected_or_first_available_variant.available == false %}disabled{% endif %}
                  >
                    <span>
                      {%- if product.selected_or_first_available_variant.available -%}
                        {{ 'products.product.add_to_cart' | t }}
                      {%- else -%}
                        {{ 'products.product.sold_out' | t }}
                      {%- endif -%}
                    </span>
                  </button>

                  {%- if block.settings.show_dynamic_checkout -%}
                    {{ form | payment_button }}
                  {%- endif -%}
                </div>

              {%- when 'description' -%}
                {%- if product.description != blank -%}
                  <div class="product-main__description rte" {{ block.shopify_attributes }}>
                    {{ product.description }}
                  </div>
                {%- endif -%}

              {%- when 'collapsible_tab' -%}
                <div class="product-main__accordion" {{ block.shopify_attributes }}>
                  <details class="accordion">
                    <summary class="accordion__summary">
                      <span class="accordion__icon">
                        {%- if block.settings.icon == 'leaf' -%}
                          {% render 'icon-leaf' %}
                        {%- elsif block.settings.icon == 'heart' -%}
                          {% render 'icon-heart' %}
                        {%- elsif block.settings.icon == 'truck' -%}
                          {% render 'icon-truck' %}
                        {%- else -%}
                          {% render 'icon-info' %}
                        {%- endif -%}
                      </span>
                      <h3 class="accordion__title">{{ block.settings.heading | escape }}</h3>
                      <span class="accordion__toggle">
                        {% render 'icon-caret' %}
                      </span>
                    </summary>
                    <div class="accordion__content rte">
                      {%- if block.settings.content != blank -%}
                        {{ block.settings.content }}
                      {%- elsif block.settings.page != blank -%}
                        {{ pages[block.settings.page].content }}
                      {%- endif -%}
                    </div>
                  </details>
                </div>

              {%- when 'share' -%}
                <div class="product-main__share" {{ block.shopify_attributes }}>
                  {% render 'social-share', share_title: product.title, share_permalink: product.url, share_image: product.featured_media %}
                </div>

            {%- endcase -%}
          {%- endfor -%}
        </div>
      </div>
    </div>
  </div>
</div>

<script type="application/ld+json">
{
  "@context": "http://schema.org/",
  "@type": "Product",
  "name": {{ product.title | json }},
  "url": {{ request.origin | append: product.url | json }},
  {% if product.featured_media %}
    "image": [
      {{ product.featured_media | image_url: width: 1024 | prepend: "https:" | json }}
    ],
  {% endif %}
  "description": {{ product.description | strip_html | json }},
  {% if product.selected_or_first_available_variant.sku != blank %}
    "sku": {{ product.selected_or_first_available_variant.sku | json }},
  {% endif %}
  "brand": {
    "@type": "Brand",
    "name": {{ product.vendor | json }}
  },
  "offers": [
    {%- for variant in product.variants -%}
      {
        "@type": "Offer",
        {%- if variant.sku != blank -%}
          "sku": {{ variant.sku | json }},
        {%- endif -%}
        "availability": "http://schema.org/{% if variant.available %}InStock{% else %}OutOfStock{% endif %}",
        "price": {{ variant.price | divided_by: 100.00 | json }},
        "priceCurrency": {{ cart.currency.iso_code | json }},
        "url": {{ request.origin | append: variant.url | json }}
      }{% unless forloop.last %},{% endunless %}
    {%- endfor -%}
  ]
}
</script>

{% schema %}
{
  "name": "Product Information",
  "tag": "section",
  "class": "section-product-main",
  "blocks": [
    {
      "type": "title",
      "name": "Title",
      "limit": 1
    },
    {
      "type": "price",
      "name": "Price",
      "limit": 1
    },
    {
      "type": "variant_picker",
      "name": "Variant Picker",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "picker_type",
          "label": "Picker type",
          "options": [
            {
              "value": "dropdown",
              "label": "Dropdown"
            },
            {
              "value": "button",
              "label": "Button"
            }
          ],
          "default": "button"
        }
      ]
    },
    {
      "type": "quantity_selector",
      "name": "Quantity Selector",
      "limit": 1
    },
    {
      "type": "buy_buttons",
      "name": "Buy Buttons",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_dynamic_checkout",
          "label": "Show dynamic checkout buttons",
          "info": "Using the payment methods available on your store, customers see their preferred option, like PayPal or Apple Pay.",
          "default": true
        }
      ]
    },
    {
      "type": "description",
      "name": "Description",
      "limit": 1
    },
    {
      "type": "collapsible_tab",
      "name": "Collapsible Tab",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Details"
        },
        {
          "type": "select",
          "id": "icon",
          "label": "Icon",
          "options": [
            {
              "value": "none",
              "label": "None"
            },
            {
              "value": "leaf",
              "label": "Leaf"
            },
            {
              "value": "heart",
              "label": "Heart"
            },
            {
              "value": "truck",
              "label": "Truck"
            },
            {
              "value": "info",
              "label": "Info"
            }
          ],
          "default": "leaf"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content"
        },
        {
          "type": "page",
          "id": "page",
          "label": "Content from page"
        }
      ]
    },
    {
      "type": "share",
      "name": "Share",
      "limit": 1
    }
  ],
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_sticky_info",
      "label": "Enable sticky product info on desktop",
      "default": true
    },
    {
      "type": "select",
      "id": "gallery_layout",
      "label": "Gallery layout",
      "options": [
        {
          "value": "stacked",
          "label": "Stacked"
        },
        {
          "value": "thumbnail_slider",
          "label": "Thumbnail slider"
        }
      ],
      "default": "thumbnail_slider"
    },
    {
      "type": "select",
      "id": "media_size",
      "label": "Media size",
      "options": [
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "large",
          "label": "Large"
        }
      ],
      "default": "medium"
    }
  ]
}
{% endschema %}
